#!/bin/bash

declare -A numTesteAtual
declare -A statusQuestao

#bg: 40 a 47, 100 a 107
#0;fg;bg
vermelho='\033[0;31m'
verde='\033[0;32m'
normal='\033[0m'
azul='\033[0;36m'
corProblema='\033[1;97;44m'

args=("$@")
ls $1
avaliar () {
	file=${args[0]}$1
	if ! [ -n "${numTesteAtual[$1]}" ]; then
		echo -e "${corProblema}              problema $1            ${normal}"
	fi
	numTesteAtual[$1]=$((numTesteAtual[$1]+1))
	if [ -f $file.c ]; then
		if [ ! -f exec$1 ]; then
			arq=$file.c
			if command -v file &> /dev/null && command -v iconv &> /dev/null; then
				charset="$(file -bi "$file.c" | awk -F "=" '{print $2}')"
				if [ "$charset" != utf-8 ]; then
					iconv -f "$charset" -t utf8 "$file.c" -o tmp.c
					arq=tmp.c
				fi
			fi
			if ! gcc "$arq" -o exec$1 -lm  2> /dev/null; then
				if ! [ -n "${statusQuestao[$1]}" ]; then
					statusQuestao[$1]='código '$file.c' não compila'
					echo -e "${vermelho} ${statusQuestao[$1]} ${normal}"
				fi
			fi
		fi
		echo -e "$2" > input
		echo -e "$3" > gabarito
		if [ -f exec$1 ]; then
			timeout 2 ./exec$1 < input > output
			printf 'Teste %d: ' ${numTesteAtual[$1]}
			if ! diff -wB output gabarito > /dev/null; then
				echo -e "${vermelho} [x]${normal}"
				echo -e '\tEntrada:' "${azul} $2 ${normal}"
				echo -e '\tSaída do seu programa:' "${azul} $(cat output) ${normal}"
				echo -e '\tSaída esperada       :' "${azul} $3 ${normal}"
			else
				echo -e "${verde} [ok] ${normal}"
			fi
		fi
	else
		if ! [ -n "${statusQuestao[$1]}" ]; then
			statusQuestao[$1]='código '$file.c' não existe'
			echo -e "${vermelho} ${statusQuestao[$1]} ${normal}"
		fi
	fi
}

if [ -e tmp.c ]; then echo "Existe um diretório/arquivo tmp.c, abortando"; exit 1; fi
if [ -e gabarito ]; then echo "Existe um diretório/arquivo gabarito, abortando"; exit 1; fi
if [ -e input ]; then echo "Existe um diretório/arquivo input, abortando"; exit 1; fi
if [ -e output ]; then echo "Existe um diretório/arquivo output, abortando"; exit 1; fi


avaliar 'q1'  '4 1 1 1 1' '1 2 3 4 1'
avaliar 'q1'  '10 1 2 3 4 5 4 3 2 1 0' '5 5'
avaliar 'q1'  '5 0 0 0 1 1' '4 5 1'
avaliar 'q1'  '1 1' '1 1'
avaliar 'q1'  '5 20 21 23 14 14' '3 23'
avaliar 'q1'  '10 5 5 6 6 7 7 8 8 7 7' '7 8 8'
avaliar 'q1'  '10 8 8 8 5 5 8 8 5 5 5' '1 2 3 6 7 8'

avaliar 'q2'  '4 1 2 3 4 1 5 3 5' '2 acertos'
avaliar 'q2'  '4 1 2 3 4 1 2 3 4' '4 acertos'
avaliar 'q2'  '7 1 2 3 2 1 5 4 3 3 3 3 3 3 3' '1 acerto'
avaliar 'q2'  '7 1 2 3 2 1 5 4 1 2 2 2 2 5 5' '4 acertos'
avaliar 'q2'  '20 4 5 3 2 1 2 5 3 2 4 1 5 4 4 4 2 3 4 2 3 4 4 2 2 2 3 5 4 2 2 1 4 1 4 4 3 3 5 2 3' '10 acertos'

avaliar 'q3'  '19 2.31 6.09 0.80 1.94 3.18 2.62 0.92 2.05 2.57 5.56 2.36 8.62 4.00 9.12 9.02 1.68 5.85 4.02 6.22 ' '7'
avaliar 'q3'  '29 5.81 3.60 6.65 9.43 5.14 6.25 2.00 0.10 8.70 7.40 8.13 4.91 8.89 2.54 6.40 1.25 1.08 5.79 7.05 2.31 4.65 0.74 1.95 7.60 4.10 8.27 9.78 0.04 8.29 ' '16'
avaliar 'q3'  '23 6.08 5.09 1.10 8.27 2.73 7.66 7.22 7.10 8.15 4.08 5.73 8.20 7.78 6.21 4.61 2.22 1.12 8.74 4.69 9.75 1.51 5.37 0.21 ' '12'
avaliar 'q3'  '24 3.85 2.40 0.86 3.97 3.57 3.13 8.44 4.77 9.91 0.31 3.28 4.27 9.92 4.90 8.83 2.52 7.96 5.64 7.20 4.69 8.92 3.59 6.95 8.73 ' '10'

avaliar 'q4' '3 2.03 3.84 1.72 4 2 0 3.14' '236.92'
avaliar 'q4' '5 3.92 1.332 8.55 -3.54 0.52 5 4 3 2 1 1.05' '13.16'

avaliar 'q5' '3 2 3 4' '5.39'
avaliar 'q5' '5 3.234 5.249 -3.232 6.12 -3.992' '9.95'
avaliar 'q5' '9 3.23 4.222 4.2207 2.001 -4.233 -6.9367 -4.3302 9.42 10.23' '17.97'

avaliar 'q6'  '4 1 4 3 7' 'N'
avaliar 'q6'  '4 1 4 3 2' 'S'
avaliar 'q6'  '4 0 4 2 1' 'N'
avaliar 'q6'  '4 1 1 2 3' 'N'
avaliar 'q6'  '4 1 4 3 2' 'S'
avaliar 'q6'  '1 1' 'S'
avaliar 'q6'  '1 0' 'N'
avaliar 'q6'  '5 5 4 3 2 1' 'S'
avaliar 'q6'  '5 4 5 2 3 6' 'N'
avaliar 'q6'  '5 5 5 5 4 3' 'N'
avaliar 'q6'  '7 6 4 3 1 2 5 7' 'S'

avaliar 'q7'  ' 3 -8.42 -8.26 1.65 2.15 9.72 -2.57 ' 'N'
avaliar 'q7'  ' 13 2.68 0.41 2.3 9.58 -1.22 0.8 0.83 7.51 -2.15 0.05 -3.54 -5.91 -6.89 -3.24 6.63 -9.64 2.8 -4.18 -0.99 1.55 -5.65 7.88 -6.8 0.44 5.98 -8.55 ' 'S'
avaliar 'q7'  ' 5 -2.15 8.44 -1.57 6.42 3.42 0.35 -5.66 -7.28 -3.02 -6.98 ' 'N'
avaliar 'q7'  ' 10 8.64 -5.7 -5.64 6.04 2.14 4.91 -7.8 -4.53 -9.27 3.97 -8.82 -2.54 -0.03 6.66 -6.99 6.85 -5.29 3.07 4.23 4.07 ' 'N'
avaliar 'q7'  ' 10 -7.24 -6.57 -9.07 3.3 -9.03 5.75 7.86 -7.33 -4.08 5.54 -0.73 -0.25 1.39 7.89 1.22 -6.35 -0.52 4.41 5.22 -5.28 ' 'N'
avaliar 'q7'  ' 6 -6.88 1.52 -8.5 1.29 5.94 -9.51 4.83 -6.18 -8.93 -7.32 6.91 -7.84 ' 'N'
avaliar 'q7'  ' 13 5.98 -2.24 -6.6 7.96 -0.99 -0.34 2.06 -5.25 -6.1 7.8 8.43 6.72 -2.43 1.87 -7.97 -5.69 -9.33 -6.15 2.7 -8.87 7.67 2.22 -9.74 5.09 -9.88 -4.41 ' 'S'
avaliar 'q7'  ' 8 -9.6 -1.23 8.81 -5.81 3.07 6.89 9.81 -7.92 -5.04 8.44 -7.53 -7.13 5.74 8.25 -0.8 5.51 ' 'N'
avaliar 'q7'  ' 19 9.94 4.04 0.29 -9.53 -1.41 -8.24 8.59 7.09 -9.32 -0.17 -2.02 -6.78 4.98 5.33 -6.08 -8.88 -6.37 -6.52 -2.49 1.93 -3.47 6.75 8.79 -5.59 8.91 1.54 2.51 7.87 2.45 -0.75 -1.99 -4.72 -2.7 4.56 2.48 8.73 3.41 7.72 ' 'S'
avaliar 'q7'  ' 11 -9.31 -5.46 7.6 0.68 -8.59 4.75 -0.38 1.69 -6.13 8.9 8.34 -9.3 6.84 -8.66 -1.41 4.77 7.97 -5.27 -6.75 8.6 2.33 -5.47 ' 'S'
avaliar 'q7'  ' 19 -3.19 -9.9 6.04 7.83 -9.83 7.22 -8.22 -7.42 -0.9 9.21 -4.98 -8.65 -6.12 -8.86 8.73 5.26 1.87 -2.37 -7.48 -5.4 -7.31 -1.51 2.96 -8.63 2.48 5.25 8.39 4.73 -2.74 -3.67 -4.02 -6.2 5.57 0.57 -1.52 5.17 -9.43 3.2 ' 'S'
avaliar 'q7'  ' 2 -3.87 3.25 -7.5 6.89 ' 'N'
avaliar 'q7'  ' 17 -5.62 -8.46 -4.06 -5.34 8.59 4.89 -0.21 -2.58 5.45 -8.71 -2.28 1.18 1.86 0.54 9.64 4.06 -6.82 3.95 6.41 3.36 -9.32 9.23 1.86 -1.0 -6.75 8.45 3.16 3.91 -8.77 0.94 7.78 2.54 5.98 1.67 ' 'N'
avaliar 'q7'  ' 19 -5.94 -6.72 6.78 -2.59 3.62 -2.02 5.37 7.4 -3.49 4.69 -3.62 3.54 -2.89 -1.09 8.38 -6.31 2.42 1.58 -6.31 -2.49 2.67 0.29 1.91 0.07 -2.05 9.51 0.39 -8.99 0.17 6.66 -1.73 5.66 4.97 0.47 3.26 -7.69 5.71 -7.52 ' 'S'
avaliar 'q7'  ' 10 -6.06 -9.15 -1.52 9.0 -6.36 6.5 9.63 -1.99 7.28 -2.99 3.11 3.34 6.67 4.09 0.63 0.47 9.61 -0.87 -4.61 5.47 ' 'N'
avaliar 'q7'  ' 4 7.26 2.17 -2.0 -6.1 -0.56 0.3 6.82 8.28 ' 'N'
avaliar 'q7'  ' 4 8.99 8.91 3.31 -9.57 -6.37 5.51 3.68 3.88 ' 'N'
avaliar 'q7'  ' 11 0.62 -1.08 -3.24 8.36 -2.38 0.24 9.8 -1.5 -6.46 9.35 2.84 -2.23 -2.68 -6.77 6.75 -4.71 -4.13 7.09 -2.6 -9.11 8.14 -1.09 ' 'N'
avaliar 'q7'  ' 16 -6.59 -3.08 6.66 -4.7 -4.31 -7.72 5.38 -1.19 5.31 5.02 -6.39 4.54 6.28 4.27 -5.96 -5.24 -8.79 -4.09 -8.1 9.45 -0.46 6.75 5.84 -0.56 1.02 -3.61 8.51 -2.17 -1.01 8.93 5.51 3.96 ' 'S'
avaliar 'q7'  ' 17 -3.06 8.79 0.86 5.7 -6.81 8.65 0.71 -8.5 -2.08 1.12 2.12 2.58 8.07 1.41 -4.2 -2.39 6.7 -3.94 2.24 4.32 9.44 4.61 -9.43 -9.43 -0.39 -0.81 -1.49 5.64 0.21 5.83 -4.04 4.88 -3.65 -9.0 ' 'S'
avaliar 'q7'  ' 11 -0.26 7.53 -0.69 0.86 -3.96 5.57 -8.67 -2.33 6.47 1.79 9.34 6.86 -1.55 4.04 -4.58 5.28 -9.4 -2.76 2.41 1.81 8.29 2.81 ' 'S'
avaliar 'q7'  ' 10 6.78 0.52 -0.71 -3.46 9.66 -9.15 -0.74 7.64 -7.33 9.75 7.04 -2.13 -8.81 1.4 -4.08 6.76 6.87 -7.74 -3.49 0.72 ' 'N'
avaliar 'q7'  ' 4 0.08 6.69 -3.44 -2.98 -0.05 -4.13 -5.98 -1.12 ' 'N'
avaliar 'q7'  ' 17 5.27 -5.59 -9.88 -9.91 6.19 8.82 1.55 7.74 4.28 4.43 0.29 1.26 7.98 9.8 -2.24 -9.1 -6.28 3.93 7.7 -8.64 0.45 -4.3 -0.08 9.73 -5.52 -7.14 -3.5 -9.51 -1.11 -7.32 1.23 -4.49 -1.29 -3.24 ' 'S'

avaliar 'q8'  ' 2 -1 4 3 ' ' 1 '
avaliar 'q8'  ' 3 -4 0 -5 0 ' ' 0 '
avaliar 'q8'  ' 4 7 6 1 -3 5 ' ' 0 '
avaliar 'q8'  ' 5 -4 7 -3 3 2 10 ' ' 1 '
avaliar 'q8'  ' 6 4 -2 -12 -10 -12 -8 4 ' ' 0 '
avaliar 'q8'  ' 7 -5 6 -8 9 7 4 -3 13 ' ' 2 '
avaliar 'q8'  ' 8 2 -16 -15 -6 -4 13 9 -13 6 ' ' 0 '
avaliar 'q8'  ' 9 -11 -14 -2 10 -11 -14 4 2 13 3 ' ' 0 '
avaliar 'q8'  ' 10 9 5 6 -15 15 1 12 6 -16 -7 -18 ' ' 0 '
avaliar 'q8'  ' 11 21 -19 -15 -9 5 6 8 21 -7 -13 -9 20 ' ' 0 '
avaliar 'q8'  ' 12 -20 7 3 5 -2 16 -21 -8 -11 -5 -15 22 -18 ' ' 1 '
avaliar 'q8'  ' 13 25 -7 -18 -5 11 -12 -22 3 20 7 9 -17 -21 -7 ' ' 1 '
avaliar 'q8'  ' 14 -20 -7 10 11 4 -3 17 -21 23 11 17 -19 -21 19 -17 ' ' 2 '
avaliar 'q8'  ' 15 -9 -28 -23 -6 29 -3 -21 -14 17 13 20 4 -30 16 -9 -12 ' ' 3 '
avaliar 'q8'  ' 16 -15 21 -18 0 25 6 30 12 7 -17 -3 -6 5 32 28 11 20 ' ' 0 '
avaliar 'q8'  ' 17 2 34 1 -15 26 31 33 19 5 26 -11 -10 -4 -34 -21 -22 3 -32 ' ' 3 '
avaliar 'q8'  ' 18 -31 -12 -1 -25 -33 -10 17 -31 32 34 -35 -3 -18 2 -8 -1 16 -16 -14 ' ' 3 '
avaliar 'q8'  ' 19 -18 13 -1 12 36 -36 -26 35 -14 -10 -19 -25 38 31 -27 -33 2 -34 34 35 ' ' 1 '
avaliar 'q8'  ' 20 -18 -30 -6 20 40 34 -20 -10 37 19 -35 34 31 -31 40 -7 19 31 -18 -4 -23 ' ' 0 '
avaliar 'q8'  ' 21 35 -40 -40 20 35 -33 -4 9 -9 41 -14 -9 15 -22 -18 10 -19 33 -30 22 -26 41 ' ' 0 '
avaliar 'q8'  ' 22 -41 35 6 27 -30 11 34 25 36 -27 -7 25 35 -10 16 12 -18 40 -42 18 -11 -10 -10 ' ' 0 '
avaliar 'q8'  ' 23 -28 40 -17 2 32 18 16 32 37 1 33 24 -43 21 42 -40 20 -38 -41 -13 -39 21 -16 -22 ' ' 4 '
avaliar 'q8'  ' 24 -1 16 29 24 10 7 -23 24 21 -26 -15 36 8 33 -9 42 45 9 20 41 -7 -28 -3 -31 -10 ' ' 4 '
avaliar 'q8'  ' 25 -19 -39 -11 -45 -29 13 -48 -44 26 23 10 22 -6 -31 2 -42 -44 -42 6 -23 16 -3 -22 -43 39 -29 ' ' 6 '
avaliar 'q8'  ' 26 -45 44 13 35 43 -4 -28 -9 5 -29 30 -34 -13 -18 -30 4 -20 -10 34 47 18 -33 22 1 -34 -23 29 ' ' 1 '
avaliar 'q8'  ' 27 -4 -38 2 -46 -47 -38 -43 -7 -44 50 7 39 9 -10 23 54 40 -7 38 29 30 4 26 -33 15 27 -5 -46 ' ' 0 '
avaliar 'q8'  ' 28 8 -34 25 50 40 -48 -29 10 28 32 -13 28 7 -22 20 9 44 55 32 -55 -17 -35 55 -51 26 -43 -8 -37 -36 ' ' 1 '
avaliar 'q8'  ' 29 47 3 46 -30 -6 32 -51 7 -27 -40 35 36 -47 -19 7 -20 -2 -25 -50 18 56 -57 37 -8 -2 -17 -44 -39 17 -46 ' ' 4 '
avaliar 'q8'  ' 30 51 37 25 36 -24 23 40 -17 25 32 25 31 -29 29 15 11 52 33 -22 28 13 -53 42 7 21 11 45 -57 37 12 38 ' ' 5 '
avaliar 'q8'  ' 31 26 -28 27 -1 60 -45 2 -36 -6 -34 21 -7 49 23 -37 -14 -41 33 -22 44 3 -21 -62 -36 -61 -26 -36 58 1 10 23 59 ' ' 4 '
avaliar 'q8'  ' 32 -3 -7 -59 53 -29 -27 -16 1 22 12 7 -60 11 47 22 -29 37 -59 64 -5 31 31 5 1 5 6 -47 23 43 46 -17 -34 -63 ' ' 4 '
avaliar 'q8'  ' 33 -63 -60 51 -27 -22 58 -30 55 -13 -5 -48 -38 15 23 -30 -13 -2 -57 0 -34 56 -41 -43 -57 -64 43 44 -27 48 62 66 51 57 -54 ' ' 3 '
avaliar 'q8'  ' 34 11 -51 65 -21 -22 -33 -16 -14 36 36 -4 49 -68 44 -20 26 37 38 -13 65 -65 -8 13 40 -24 19 33 21 -66 20 -59 27 10 -29 -14 ' ' 3 '
avaliar 'q8'  ' 35 -60 -23 28 -55 -32 -22 8 33 11 -48 -31 67 5 59 2 14 36 66 -65 -42 31 -23 5 34 -19 55 0 14 48 28 66 38 -51 -30 -6 7 ' ' 5 '
avaliar 'q8'  ' 36 -49 -21 55 -69 42 72 -59 -29 27 55 -49 38 22 -56 -36 -41 71 -18 -29 -43 72 45 -16 46 -30 -58 6 72 22 -10 -10 68 -63 17 -17 36 3 ' ' 4 '
avaliar 'q8'  ' 37 -51 -55 12 57 -53 37 57 -5 -3 -9 -50 -53 59 57 15 -4 -72 4 50 16 30 -13 -1 43 -42 26 67 -38 4 -36 13 -63 -73 -18 0 -30 3 -26 ' ' 5 '
avaliar 'q8'  ' 38 0 34 11 -17 64 -28 9 -68 56 -51 -66 68 -35 -75 61 57 69 14 10 73 22 1 -12 -18 -69 -4 -31 30 72 63 -62 -30 -76 10 -4 -35 59 -36 30 ' ' 4 '
avaliar 'q8'  ' 39 -46 -52 -43 17 73 -57 18 -63 -27 -77 -12 22 41 20 -53 25 17 23 30 -41 11 -65 67 64 -42 -57 29 -35 -22 17 -48 -28 42 -11 -21 -8 27 25 75 31 ' ' 3 '
avaliar 'q8'  ' 40 -45 47 20 32 50 -35 49 -17 40 -50 -41 -2 47 -44 -38 56 -57 69 10 -38 -12 -60 41 -18 1 45 -15 -21 -10 -32 8 21 77 -6 -57 -1 32 -37 79 68 -31 ' ' 3 '
avaliar 'q8'  ' 41 30 18 -30 -65 -29 33 -66 21 66 -25 -53 80 -8 -47 -74 43 36 -22 -11 69 31 56 -35 9 69 67 -20 -47 -79 78 -6 57 -73 -70 27 77 -28 77 68 -46 -81 -47 ' ' 3 '
avaliar 'q8'  ' 42 -77 31 26 -66 -49 -47 -75 -78 58 -62 17 38 -71 31 3 4 -70 31 24 49 4 31 -62 -9 66 1 23 32 24 27 -68 -84 65 56 -66 -56 -2 -20 79 43 71 29 -44 ' ' 9 '
avaliar 'q8'  ' 43 -69 -85 13 -86 -73 -42 12 42 54 13 -52 32 84 44 8 -16 -80 5 -11 -77 -64 -58 -21 25 -85 -27 55 39 84 -66 52 50 -2 77 32 35 -17 -5 -83 70 22 -70 76 -4 ' ' 5 '
avaliar 'q8'  ' 44 -67 0 38 -72 45 -22 87 30 -29 29 -7 32 23 61 32 60 35 -35 -40 58 -57 -58 8 19 78 59 -12 58 32 -85 -60 -20 38 -22 -83 51 10 29 -81 -82 -76 38 33 -16 67 ' ' 11 '
avaliar 'q8'  ' 45 -61 -57 37 31 -21 89 35 31 -62 26 -41 1 -53 -78 -38 38 64 44 46 -30 -13 59 16 52 -6 -90 -30 50 31 17 82 26 13 85 -3 23 75 -50 87 89 -17 -22 6 66 89 84 ' ' 2 '
avaliar 'q8'  ' 46 90 29 -54 -68 -83 6 -91 -46 89 35 -84 37 -62 35 62 -52 1 59 -58 68 -75 24 53 -61 -55 -39 -43 -63 -51 92 59 -82 -87 11 87 28 55 -68 39 -64 17 -20 75 -85 71 33 58 ' ' 0 '
avaliar 'q8'  ' 47 61 86 -58 -47 -67 2 54 36 79 -68 19 64 37 93 -66 -19 57 -66 -57 14 29 69 53 41 -48 -35 93 -10 79 34 39 -65 -77 37 64 63 -14 35 21 58 -77 81 -82 40 -63 -38 17 -57 ' ' 2 '
avaliar 'q8'  ' 48 75 43 65 93 -46 -45 94 -48 -51 8 72 -23 -10 92 29 40 -73 48 -59 -62 -94 37 1 1 -54 -31 -74 -37 -64 28 -53 -78 -19 59 9 52 -39 -90 38 -6 -90 83 28 92 36 24 19 40 81 ' ' 3 '
avaliar 'q8'  ' 49 -47 -36 -62 -46 -14 28 22 42 -67 55 86 43 75 -95 58 -9 57 96 34 -93 -15 -37 10 -62 34 -65 92 75 -72 -91 9 -97 91 -73 50 78 13 90 16 90 6 -59 -27 29 -12 -48 -31 -49 36 -11 ' ' 3 '

rm tmp.c gabarito input output exec* 2> /dev/null
